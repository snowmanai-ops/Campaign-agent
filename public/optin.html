<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />

  <!-- ============================================
       SEO & SOCIAL META TAGS
       ============================================ -->
  <title>Campaign Agent — Create Email Campaigns in 3 Minutes with AI</title>
  <meta name="description" content="AI-powered email campaign builder trained on million-dollar frameworks. Create welcome series, nurture sequences, launch campaigns and more — customized to your brand in minutes." />

  <meta property="og:type" content="website" />
  <meta property="og:title" content="Create Email Campaigns in 3 Minutes with AI" />
  <meta property="og:description" content="AI trained on million-dollar email frameworks writes your welcome series, launch sequences, nurture campaigns and more — customized to your brand." />
  <!-- UPDATE: Replace with your actual OG image URL -->
  <meta property="og:image" content="/og-image.png" />

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Create Email Campaigns in 3 Minutes with AI" />
  <meta name="twitter:description" content="AI trained on million-dollar email frameworks writes your welcome series, launch sequences, nurture campaigns and more." />
  <meta name="twitter:image" content="/og-image.png" />

  <!-- ============================================
       FONTS & TAILWIND
       ============================================ -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      },
    };
  </script>

  <!-- ============================================
       STYLES
       ============================================ -->
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', system-ui, sans-serif; }

    /* Animated gradient background */
    .bg-gradient-animated {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 40%, #312e81 100%);
      background-size: 200% 200%;
      animation: gradientShift 15s ease infinite;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* Headline underline effect */
    .highlight-underline {
      text-decoration: none;
      background-image: linear-gradient(120deg, #4F46E5 0%, #6366f1 100%);
      background-repeat: no-repeat;
      background-size: 100% 0.3em;
      background-position: 0 88%;
    }

    /* Spinner */
    .spinner {
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255,255,255,0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.6s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Step transitions */
    .step-container {
      transition: opacity 0.25s ease, transform 0.25s ease;
    }
    .step-hidden {
      opacity: 0;
      transform: translateY(8px);
      pointer-events: none;
      position: absolute;
      width: 100%;
    }
    .step-visible {
      opacity: 1;
      transform: translateY(0);
    }

    /* Option card hover */
    .option-card {
      transition: all 0.2s ease;
    }
    .option-card:hover {
      background: rgba(255,255,255,0.12);
      border-color: rgba(79, 70, 229, 0.5);
      transform: translateY(-2px);
    }
    .option-card:active {
      transform: translateY(0);
    }

    /* Respect reduced motion */
    @media (prefers-reduced-motion: reduce) {
      .bg-gradient-animated { animation: none; }
      .step-container { transition-duration: 0.01ms !important; }
      .option-card { transition-duration: 0.01ms !important; }
      .spinner { animation-duration: 0.01ms !important; }
    }
  </style>
</head>

<body class="bg-gradient-animated min-h-screen flex items-start justify-center pt-[8vh] sm:pt-[10vh] p-4 antialiased">

  <!-- ============================================
       PAGE CONTENT
       ============================================ -->
  <div class="w-full max-w-md md:max-w-lg relative">
    <div class="bg-slate-900/80 backdrop-blur-xl border border-white/10 rounded-2xl shadow-2xl p-6 sm:p-8 md:p-10 relative overflow-hidden">

      <!-- Steps wrapper (relative for absolute positioning of hidden step) -->
      <div class="relative">

        <!-- ============================================
             STEP 1: Email Capture
             ============================================ -->
        <div id="step-1" class="step-container step-visible">

          <!-- Product Mockup SVG — matches CampaignView screenshot -->
          <div class="flex justify-center mb-6">
            <svg viewBox="0 0 480 260" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-full max-w-[420px] rounded-xl overflow-hidden" style="filter: drop-shadow(0 8px 24px rgba(0,0,0,0.3));">
              <!-- Window frame -->
              <rect width="480" height="260" rx="10" fill="#f9fafb"/>
              <!-- Title bar -->
              <rect width="480" height="28" rx="10" fill="#f1f5f9"/>
              <rect y="10" width="480" height="18" fill="#f1f5f9"/>
              <!-- Traffic lights -->
              <circle cx="16" cy="14" r="4" fill="#ef4444" opacity="0.7"/>
              <circle cx="28" cy="14" r="4" fill="#eab308" opacity="0.7"/>
              <circle cx="40" cy="14" r="4" fill="#22c55e" opacity="0.7"/>
              <!-- Title text -->
              <rect x="60" y="10" width="100" height="8" rx="4" fill="#94a3b8" opacity="0.5"/>

              <!-- ===== LEFT SIDEBAR (email list) ===== -->
              <rect x="0" y="28" width="155" height="232" fill="#ffffff"/>
              <line x1="155" y1="28" x2="155" y2="260" stroke="#e2e8f0" stroke-width="1"/>

              <!-- Header row -->
              <text x="10" y="46" font-family="Inter,sans-serif" font-size="6" font-weight="600" fill="#64748b" letter-spacing="0.5">SEQUENCE</text>
              <text x="110" y="46" font-family="Inter,sans-serif" font-size="6" font-weight="600" fill="#64748b">7 EMAILS</text>

              <!-- Email 1 (active — indigo ring) -->
              <rect x="6" y="52" width="143" height="30" rx="6" fill="#eef2ff" stroke="#4F46E5" stroke-width="1.5"/>
              <circle cx="18" cy="62" r="6" fill="#4F46E5"/>
              <text x="15.5" y="64.5" font-family="Inter,sans-serif" font-size="6" font-weight="600" fill="#ffffff">1</text>
              <rect x="28" y="57" width="32" height="4" rx="2" fill="#dbeafe"/>
              <text x="31" y="60" font-family="Inter,sans-serif" font-size="3.5" font-weight="600" fill="#3b82f6">Welcome</text>
              <text x="108" y="60" font-family="Inter,sans-serif" font-size="4" fill="#94a3b8">Instant</text>
              <rect x="28" y="65" width="80" height="4" rx="2" fill="#94a3b8" opacity="0.3"/>
              <rect x="28" y="72" width="60" height="3" rx="1.5" fill="#94a3b8" opacity="0.2"/>

              <!-- Email 2 -->
              <rect x="6" y="86" width="143" height="24" rx="6" fill="#ffffff" stroke="#e2e8f0" stroke-width="0.5"/>
              <circle cx="18" cy="98" r="6" fill="#f1f5f9"/>
              <text x="15.5" y="100.5" font-family="Inter,sans-serif" font-size="6" font-weight="500" fill="#64748b">2</text>
              <rect x="28" y="93" width="46" height="4" rx="2" fill="#dbeafe"/>
              <text x="30" y="96" font-family="Inter,sans-serif" font-size="3.5" font-weight="600" fill="#3b82f6">Social Proof</text>
              <text x="118" y="96" font-family="Inter,sans-serif" font-size="4" fill="#94a3b8">Day 1</text>
              <rect x="28" y="100" width="70" height="3" rx="1.5" fill="#94a3b8" opacity="0.25"/>

              <!-- Email 3 -->
              <rect x="6" y="114" width="143" height="24" rx="6" fill="#ffffff" stroke="#e2e8f0" stroke-width="0.5"/>
              <circle cx="18" cy="126" r="6" fill="#f1f5f9"/>
              <text x="15.5" y="128.5" font-family="Inter,sans-serif" font-size="6" font-weight="500" fill="#64748b">3</text>
              <rect x="28" y="121" width="60" height="4" rx="2" fill="#fce7f3"/>
              <text x="30" y="124" font-family="Inter,sans-serif" font-size="3.5" font-weight="600" fill="#db2777">Problem Recognition</text>
              <text x="118" y="124" font-family="Inter,sans-serif" font-size="4" fill="#94a3b8">Day 3</text>
              <rect x="28" y="128" width="65" height="3" rx="1.5" fill="#94a3b8" opacity="0.25"/>

              <!-- Email 4 -->
              <rect x="6" y="142" width="143" height="24" rx="6" fill="#ffffff" stroke="#e2e8f0" stroke-width="0.5"/>
              <circle cx="18" cy="154" r="6" fill="#f1f5f9"/>
              <text x="15.5" y="156.5" font-family="Inter,sans-serif" font-size="6" font-weight="500" fill="#64748b">4</text>
              <rect x="28" y="149" width="56" height="4" rx="2" fill="#d1fae5"/>
              <text x="30" y="152" font-family="Inter,sans-serif" font-size="3.5" font-weight="600" fill="#059669">Educational Value</text>
              <text x="118" y="152" font-family="Inter,sans-serif" font-size="4" fill="#94a3b8">Day 5</text>
              <rect x="28" y="156" width="72" height="3" rx="1.5" fill="#94a3b8" opacity="0.25"/>

              <!-- Email 5 -->
              <rect x="6" y="170" width="143" height="24" rx="6" fill="#ffffff" stroke="#e2e8f0" stroke-width="0.5"/>
              <circle cx="18" cy="182" r="6" fill="#f1f5f9"/>
              <text x="15.5" y="184.5" font-family="Inter,sans-serif" font-size="6" font-weight="500" fill="#64748b">5</text>
              <rect x="28" y="177" width="52" height="4" rx="2" fill="#fef3c7"/>
              <text x="30" y="180" font-family="Inter,sans-serif" font-size="3.5" font-weight="600" fill="#d97706">Differentiation</text>
              <text x="118" y="180" font-family="Inter,sans-serif" font-size="4" fill="#94a3b8">Day 7</text>
              <rect x="28" y="184" width="68" height="3" rx="1.5" fill="#94a3b8" opacity="0.25"/>

              <!-- Email 6 -->
              <rect x="6" y="198" width="143" height="24" rx="6" fill="#ffffff" stroke="#e2e8f0" stroke-width="0.5"/>
              <circle cx="18" cy="210" r="6" fill="#f1f5f9"/>
              <text x="15.5" y="212.5" font-family="Inter,sans-serif" font-size="6" font-weight="500" fill="#64748b">6</text>
              <rect x="28" y="205" width="36" height="4" rx="2" fill="#fee2e2"/>
              <text x="30" y="208" font-family="Inter,sans-serif" font-size="3.5" font-weight="600" fill="#dc2626">Urgency</text>
              <text x="114" y="208" font-family="Inter,sans-serif" font-size="4" fill="#94a3b8">Day 10</text>
              <rect x="28" y="212" width="75" height="3" rx="1.5" fill="#94a3b8" opacity="0.25"/>

              <!-- Email 7 -->
              <rect x="6" y="226" width="143" height="24" rx="6" fill="#ffffff" stroke="#e2e8f0" stroke-width="0.5"/>
              <circle cx="18" cy="238" r="6" fill="#f1f5f9"/>
              <text x="15.5" y="240.5" font-family="Inter,sans-serif" font-size="6" font-weight="500" fill="#64748b">7</text>
              <rect x="28" y="233" width="66" height="4" rx="2" fill="#e0e7ff"/>
              <text x="30" y="236" font-family="Inter,sans-serif" font-size="3.5" font-weight="600" fill="#4338ca">Final Value Proposition</text>
              <text x="114" y="236" font-family="Inter,sans-serif" font-size="4" fill="#94a3b8">Day 14</text>
              <rect x="28" y="240" width="58" height="3" rx="1.5" fill="#94a3b8" opacity="0.25"/>

              <!-- ===== RIGHT PANEL (email editor) ===== -->
              <rect x="155" y="28" width="325" height="232" fill="#f9fafb"/>

              <!-- Editor header -->
              <text x="168" y="46" font-family="Inter,sans-serif" font-size="5" font-weight="600" fill="#4F46E5" letter-spacing="0.5">EDITING EMAIL 1</text>
              <rect x="168" y="50" width="200" height="9" rx="2" fill="#0f172a" opacity="0.05"/>
              <text x="170" y="57" font-family="Inter,sans-serif" font-size="6" font-weight="700" fill="#0f172a">Your free audit is here (+ what to expect)</text>

              <!-- Action buttons -->
              <rect x="400" y="36" width="34" height="14" rx="4" fill="#4F46E5"/>
              <text x="404" y="45.5" font-family="Inter,sans-serif" font-size="4.5" font-weight="600" fill="#ffffff">Save</text>
              <rect x="440" y="36" width="30" height="14" rx="4" fill="#f1f5f9" stroke="#e2e8f0" stroke-width="0.5"/>
              <text x="444" y="45.5" font-family="Inter,sans-serif" font-size="4.5" font-weight="500" fill="#64748b">Close</text>

              <!-- Subject line field -->
              <text x="168" y="76" font-family="Inter,sans-serif" font-size="5" font-weight="500" fill="#64748b">Subject Line</text>
              <rect x="168" y="80" width="140" height="16" rx="5" fill="#ffffff" stroke="#e2e8f0" stroke-width="0.75"/>
              <text x="174" y="90.5" font-family="Inter,sans-serif" font-size="5" fill="#334155">Your free audit is here (+ what to expect)</text>

              <!-- Preview text field -->
              <text x="320" y="76" font-family="Inter,sans-serif" font-size="5" font-weight="500" fill="#64748b">Preview Text</text>
              <rect x="320" y="80" width="148" height="16" rx="5" fill="#ffffff" stroke="#e2e8f0" stroke-width="0.75"/>
              <text x="326" y="90.5" font-family="Inter,sans-serif" font-size="5" fill="#334155">Let's find where your time is bleeding</text>

              <!-- Divider -->
              <line x1="168" y1="108" x2="465" y2="108" stroke="#e2e8f0" stroke-width="0.5"/>
              <text x="295" y="112" font-family="Inter,sans-serif" font-size="4.5" font-weight="600" fill="#94a3b8" text-anchor="middle" letter-spacing="1">EMAIL CONTENT</text>

              <!-- Email body area -->
              <text x="168" y="126" font-family="Inter,sans-serif" font-size="5" font-weight="500" fill="#64748b">Email Body</text>
              <rect x="168" y="130" width="298" height="118" rx="6" fill="#ffffff" stroke="#e2e8f0" stroke-width="0.75"/>

              <!-- Body text content -->
              <text x="176" y="142" font-family="Inter,sans-serif" font-size="5" font-weight="500" fill="#0f172a">Welcome to Work Agentic.</text>
              <text x="176" y="152" font-family="Inter,sans-serif" font-size="4.5" fill="#475569">You signed up for our free audit, so let's get</text>
              <text x="176" y="159" font-family="Inter,sans-serif" font-size="4.5" fill="#475569">straight to it.</text>
              <text x="176" y="171" font-family="Inter,sans-serif" font-size="4.5" font-weight="500" fill="#0f172a">Here's what happens next:</text>
              <text x="176" y="181" font-family="Inter,sans-serif" font-size="4.5" fill="#475569">1. We'll analyze your current workflows</text>
              <text x="176" y="189" font-family="Inter,sans-serif" font-size="4.5" fill="#475569">2. Identify the biggest time drains</text>
              <text x="176" y="197" font-family="Inter,sans-serif" font-size="4.5" fill="#475569">3. Show exactly where AI can automate</text>
              <text x="176" y="205" font-family="Inter,sans-serif" font-size="4.5" fill="#475569">4. Give you a clear implementation roadmap</text>
              <text x="176" y="217" font-family="Inter,sans-serif" font-size="4.5" fill="#475569">No fluff. No generic advice. Just actionable</text>
              <text x="176" y="225" font-family="Inter,sans-serif" font-size="4.5" fill="#475569">insights.</text>

              <!-- Bottom rounded corners -->
              <rect y="250" width="480" height="10" rx="0" fill="#f9fafb"/>
              <rect y="250" width="480" height="10" rx="10" fill="#f9fafb" transform="translate(0, 0)"/>
            </svg>
          </div>

          <!-- Headline -->
          <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold text-white text-center tracking-tight mb-4 leading-tight">
            Get ready-to-send email sequences in <span class="highlight-underline">3 minutes</span>.
          </h1>

          <!-- Subheadline -->
          <p class="text-sm sm:text-base text-white/70 text-center leading-relaxed mb-6">
            Built on 57 proven frameworks that have generated millions in revenue.
          </p>

          <!-- Email Form -->
          <form id="optin-form" class="space-y-3" novalidate>
            <input
              id="email-input"
              type="email"
              placeholder="Enter your best email"
              autocomplete="email"
              required
              class="w-full bg-white border border-white/80 text-slate-900 placeholder:text-slate-400 rounded-xl px-4 py-3.5 text-sm focus:outline-none focus:border-indigo-400 focus:ring-2 focus:ring-indigo-400/30 transition-all disabled:opacity-50"
            />

            <!-- Error message -->
            <div id="error-msg" class="hidden text-sm text-red-400 bg-red-400/10 border border-red-400/20 rounded-xl px-4 py-2.5"></div>

            <!-- CTA Button -->
            <button
              id="submit-btn"
              type="submit"
              class="w-full bg-indigo-600 hover:bg-indigo-500 text-white font-semibold rounded-xl px-6 py-3.5 shadow-lg shadow-indigo-600/25 transition-all duration-200 hover:shadow-xl hover:shadow-indigo-600/30 hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:translate-y-0 flex items-center justify-center gap-2 cursor-pointer"
            >
              <span id="btn-text">Create My First Campaign</span>
              <svg id="btn-arrow" xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6" /></svg>
              <span id="btn-spinner" class="spinner hidden"></span>
            </button>
          </form>

          <!-- Microcopy -->
          <p class="text-xs text-white/40 text-center mt-6 leading-relaxed">
            Copywriters charge $500+ for a single email sequence. This tool gives you unlimited campaigns, 100% free. You'll also receive 2-Minute Agents, our free weekly newsletter read by an international audience of growth-focused founders, plus real-world AI workflow breakdowns you can steal for your own business. Your information is 100% secure and will never be shared with anyone.
          </p>
        </div>

        <!-- ============================================
             STEP 2: Segmentation Question
             ============================================ -->
        <div id="step-2" class="step-container step-hidden">

          <!-- Question -->
          <div class="text-center mb-2">
            <p class="text-white/50 text-sm mb-2">One quick question&hellip;</p>
            <h2 class="text-xl sm:text-2xl font-bold text-white tracking-tight mb-2">What is your primary goal?</h2>
            <p class="text-sm text-white/50">This helps us personalize your experience.</p>
          </div>

          <!-- Option Cards -->
          <div class="space-y-3 mt-8">

            <!-- Option A: Business Owner -->
            <button
              id="option-lead"
              type="button"
              class="option-card w-full bg-white/8 border border-white/15 rounded-xl p-5 cursor-pointer text-left flex items-start gap-4 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:translate-y-0"
            >
              <!-- Briefcase icon -->
              <div class="shrink-0 w-10 h-10 rounded-lg bg-indigo-600/20 flex items-center justify-center mt-0.5">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-indigo-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M20 7H4a1 1 0 00-1 1v10a2 2 0 002 2h14a2 2 0 002-2V8a1 1 0 00-1-1z" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M16 7V5a2 2 0 00-2-2h-4a2 2 0 00-2 2v2" />
                </svg>
              </div>
              <div>
                <p class="text-white font-semibold text-sm sm:text-base">Automate my own business</p>
                <p class="text-white/50 text-xs sm:text-sm mt-1">I'm a Business Owner</p>
              </div>
              <div class="ml-auto shrink-0 self-center">
                <span class="option-spinner hidden spinner"></span>
                <svg xmlns="http://www.w3.org/2000/svg" class="option-arrow w-5 h-5 text-white/30" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" /></svg>
              </div>
            </button>

            <!-- Option B: Builder -->
            <button
              id="option-student"
              type="button"
              class="option-card w-full bg-white/8 border border-white/15 rounded-xl p-5 cursor-pointer text-left flex items-start gap-4 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:translate-y-0"
            >
              <!-- Code icon -->
              <div class="shrink-0 w-10 h-10 rounded-lg bg-indigo-600/20 flex items-center justify-center mt-0.5">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-indigo-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M17.25 6.75L22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5-3l-4.5 16.5" />
                </svg>
              </div>
              <div>
                <p class="text-white font-semibold text-sm sm:text-base">Learn to build tools like this</p>
                <p class="text-white/50 text-xs sm:text-sm mt-1">I'm a Builder</p>
              </div>
              <div class="ml-auto shrink-0 self-center">
                <span class="option-spinner hidden spinner"></span>
                <svg xmlns="http://www.w3.org/2000/svg" class="option-arrow w-5 h-5 text-white/30" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" /></svg>
              </div>
            </button>
          </div>

          <!-- Step 2 error message -->
          <div id="step2-error-msg" class="hidden text-sm text-red-400 bg-red-400/10 border border-red-400/20 rounded-xl px-4 py-2.5 mt-4"></div>
        </div>

      </div><!-- end steps wrapper -->
    </div><!-- end card -->

    <!-- Privacy / Terms — outside the card -->
    <p class="text-xs text-white/30 text-center mt-4">
      <!-- UPDATE: Replace # with your actual URLs -->
      <a href="#" class="text-white/40 hover:text-white/60 underline transition-colors">Privacy Policy</a>
      &amp;
      <a href="#" class="text-white/40 hover:text-white/60 underline transition-colors">Terms of Service</a>
    </p>
  </div>

  <!-- ============================================
       JAVASCRIPT — Form handling & ConvertKit API
       ============================================ -->
  <script>
    // === CONFIGURATION (UPDATE THESE) ===
    const CONVERTKIT_FORM_ID = '9065010';
    const CONVERTKIT_API_KEY = 'kit_b64597ccba60990044ff5df8f89039ba';
    const TAG_LEAD = '15728407';       // ConvertKit tag ID for "Business Owner"
    const TAG_STUDENT = '15728408';  // ConvertKit tag ID for "Builder"
    const REDIRECT_URL = './index.html#/onboarding?ref=optin';

    // Warn if not configured
    if (CONVERTKIT_FORM_ID.includes('YOUR_') || CONVERTKIT_API_KEY.includes('YOUR_')) {
      console.warn('[Campaign Agent Opt-in] ConvertKit credentials not configured. Update the CONFIGURATION section in optin.html.');
    }

    // === STATE ===
    let capturedEmail = '';

    // === DOM REFERENCES ===
    const form = document.getElementById('optin-form');
    const emailInput = document.getElementById('email-input');
    const submitBtn = document.getElementById('submit-btn');
    const btnText = document.getElementById('btn-text');
    const btnArrow = document.getElementById('btn-arrow');
    const btnSpinner = document.getElementById('btn-spinner');
    const errorMsg = document.getElementById('error-msg');
    const step1 = document.getElementById('step-1');
    const step2 = document.getElementById('step-2');
    const optionLead = document.getElementById('option-lead');
    const optionStudent = document.getElementById('option-student');
    const step2ErrorMsg = document.getElementById('step2-error-msg');

    // === STEP 1: EMAIL FORM ===
    form.addEventListener('submit', (e) => {
      e.preventDefault();

      const email = emailInput.value.trim();

      if (!email) {
        showError(errorMsg, 'Please enter your email address.');
        return;
      }
      if (!isValidEmail(email)) {
        showError(errorMsg, 'Please enter a valid email address.');
        return;
      }

      hideError(errorMsg);
      capturedEmail = email;
      goToStep2();
    });

    // === STEP 2: SEGMENTATION ===
    optionLead.addEventListener('click', () => submitWithTag(TAG_LEAD, optionLead));
    optionStudent.addEventListener('click', () => submitWithTag(TAG_STUDENT, optionStudent));

    async function submitWithTag(tagId, clickedBtn) {
      hideError(step2ErrorMsg);
      setOptionsLoading(true, clickedBtn);

      try {
        const response = await fetch(
          `https://api.convertkit.com/v3/forms/${CONVERTKIT_FORM_ID}/subscribe`,
          {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              api_key: CONVERTKIT_API_KEY,
              email: capturedEmail,
              tags: [tagId],
            }),
          }
        );

        if (!response.ok) {
          const data = await response.json().catch(() => ({}));
          throw new Error(data.message || 'Subscription failed. Please try again.');
        }

        const data = await response.json();

        if (data.subscription) {
          window.location.href = REDIRECT_URL;
        } else {
          throw new Error('Unexpected response. Please try again.');
        }
      } catch (err) {
        showError(step2ErrorMsg, err.message || 'Something went wrong. Please try again.');
        setOptionsLoading(false, null);
      }
    }

    // === STEP TRANSITIONS ===
    function goToStep2() {
      step1.classList.remove('step-visible');
      step1.classList.add('step-hidden');

      setTimeout(() => {
        step2.classList.remove('step-hidden');
        step2.classList.add('step-visible');
      }, 150);
    }

    // === HELPERS ===
    function isValidEmail(email) {
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }

    function showError(el, msg) {
      el.textContent = msg;
      el.classList.remove('hidden');
    }

    function hideError(el) {
      el.classList.add('hidden');
    }

    function setOptionsLoading(isLoading, activeBtn) {
      optionLead.disabled = isLoading;
      optionStudent.disabled = isLoading;

      // Show spinner on the clicked button, hide arrow
      if (isLoading && activeBtn) {
        const spinner = activeBtn.querySelector('.option-spinner');
        const arrow = activeBtn.querySelector('.option-arrow');
        if (spinner) spinner.classList.remove('hidden');
        if (arrow) arrow.classList.add('hidden');
      } else {
        // Reset all
        document.querySelectorAll('.option-spinner').forEach(s => s.classList.add('hidden'));
        document.querySelectorAll('.option-arrow').forEach(a => a.classList.remove('hidden'));
      }
    }
  </script>
</body>
</html>
